{% extends 'dashboard_template.html' %}
{% load static %}
{% block content_dashboard %}
<div class="border border-2 border-secondary-subtle rounded h-100 p-4">
    <div class="row">
        <!-- Formulario de Ubicaciones -->
        <form class="col-sm-12 col-md-6 col-lg-6 col-xl-4 col-xxl-4 mb-3" method="post" id="ubicacionesForm">
            {% csrf_token %}
            <input type="hidden" name="type" value="ubicaciones">
            <input type="hidden" name="action" value="delete">
            <div class="card bg-transparent transition-200 h-100">
                <div class="card-header bg-secondary bg-opacity-10">
                    <h5 class="form-label fw-semibold text-uppercase text-muted mb-0">Ubicaciones</h5>
                </div>
                <div class="card-body d-flex flex-column flex-md-row p-2 p-md-3">
                    <!-- Select - Ocupa todo el espacio disponible -->
                    <select id="listUbicaciones"
                        class="form-select bg-transparent border border-2 border-secondary-subtle mb-2 mb-md-0 me-md-2 flex-grow-1"
                        size="5" name="element" required>
                        {% for ubicacion in ubicaciones %}
                        <option value="{{ ubicacion.id }}">{{ ubicacion.nombre }}</option>
                        {% endfor %}
                    </select>

                    <!-- Botones - Tamaño fijo con espacio responsive -->
                    <div class="d-flex flex-row flex-md-column justify-content-center gap-2" style="min-width: 40px;">
                        <button type="button" id="create-ubicacion" data-bs-toggle-tooltip="tooltip"
                            data-bs-title="Agregar Ubicacion" data-bs-toggle="modal" data-bs-target="#configModal"
                            hx-get="{% url 'create-ubicacion-htmx' %}" hx-target="#configModalContent" hx-swap="innerHTML" hx-trigger="click"
                            class="btn btn-outline-success-sdcn rounded-0 w-100">
                            <i class="bi bi-plus-circle"></i>
                        </button>
                        <button type="button" id="update-ubicacion" data-bs-toggle-tooltip="tooltip"
                            data-bs-title="Editar Ubicacion" data-bs-toggle="modal" data-bs-target="#configModal"
                            hx-include="#listUbicaciones" hx-get="{% url 'update-ubicacion-htmx' %}" hx-target="#configModalContent" hx-swap="innerHTML" hx-trigger="click"
                            data-bs-toggle="modal" data-bs-target="#configModal"
                            class="btn btn-outline-primary-sdcn rounded-0 w-100">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button type="submit" id="delete-ubicacion" data-bs-toggle-tooltip="tooltip"
                            data-bs-title="Eliminar Ubicacion" class="btn btn-outline-danger-sdcn rounded-0 w-100">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </form>

        <!-- Formulario de Áreas -->
        <form class="col-sm-12 col-md-6 col-lg-6 col-xl-4 col-xxl-4 mb-3" method="post" id="areasForm">
            {% csrf_token %}
            <input type="hidden" name="type" value="areas">
            <input type="hidden" name="action" value="delete">
            <div class="card bg-transparent transition-200 h-100">
                <div class="card-header bg-secondary bg-opacity-10">
                    <h5 class="form-label fw-semibold text-uppercase text-muted mb-0">Áreas</h5>
                </div>
                <div class="card-body d-flex flex-column flex-md-row p-2 p-md-3">
                    <select id="listAreas"
                        class="form-select bg-transparent border border-2 border-secondary-subtle mb-2 mb-md-0 me-md-2 flex-grow-1"
                        size="5" name="element" required>
                        {% for area in areas %}
                        {% if not area.nombre == "Sin Área" %}
                        <option value="{{ area.id }}">{{ area.nombre }}</option>
                        {% endif %}
                        {% endfor %}
                    </select>
                    <div class="d-flex flex-row flex-md-column justify-content-center gap-2" style="min-width: 40px;">
                        <button type="button" id="create-area"  data-bs-toggle-tooltip="tooltip"
                            data-bs-title="Agregar Área" data-bs-toggle="modal" data-bs-target="#configModal"
                            hx-get="{% url 'create-areas-htmx' %}" hx-target="#configModalContent" hx-swap="innerHTML" hx-trigger="click"
                            class="btn btn-outline-success-sdcn rounded-0 w-100">
                            <i class="bi bi-plus-circle"></i>
                        </button>
                        <button type="button" id="update-area" data-bs-toggle-tooltip="tooltip"
                            data-bs-title="Editar Área" data-bs-toggle="modal" data-bs-target="#configModal"
                            hx-include="#listAreas" hx-get="{% url 'update-areas-htmx' %}" hx-target="#configModalContent" hx-swap="innerHTML" hx-trigger="click"
                            data-bs-toggle="modal" data-bs-target="#configModal"
                            class="btn btn-outline-primary-sdcn rounded-0 w-100">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button type="submit" id="delete-area" data-bs-toggle-tooltip="tooltip"
                            data-bs-title="Eliminar Área" class="btn btn-outline-danger-sdcn rounded-0 w-100">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </form>

        <!-- Formulario de Estados -->
        <form class="col-sm-12 col-md-6 col-lg-6 col-xl-4 col-xxl-4 mb-3" method="post" id="estadosForm">
            {% csrf_token %}
            <input type="hidden" name="type" value="estados1">
            <input type="hidden" name="action" value="delete">
            <div class="card bg-transparent transition-200 h-100">
                <div class="card-header bg-secondary bg-opacity-10">
                    <h5 class="form-label fw-semibold text-uppercase text-muted mb-0">Estados</h5>
                </div>
                <div class="card-body d-flex flex-column flex-md-row p-2 p-md-3">
                    <select id="listEstados"
                        class="form-select bg-transparent border border-2 border-secondary-subtle mb-2 mb-md-0 me-md-2 flex-grow-1"
                        size="5" name="valor" required>
                        {% for value, label in ESTADOS.choices %}
                        <option value="{{ value }}">{{ label }}</option>
                        {% endfor %}
                    </select>
                    <div class="d-flex flex-row flex-md-column justify-content-center gap-2" style="min-width: 40px;">
                        <button type="button" id="create-estados" data-bs-toggle-tooltip="tooltip"
                            data-bs-title="Agregar Estado de Activo fijo" data-bs-toggle="modal" data-bs-target="#configModal"
                            hx-get="{% url 'create-estados-htmx' %}" hx-target="#configModalContent" hx-swap="innerHTML" hx-trigger="click"
                            class="btn btn-outline-success-sdcn rounded-0 w-100">
                            <i class="bi bi-plus-circle"></i>
                        </button>
                        <button type="button" id="update-estados" data-bs-toggle-tooltip="tooltip"
                            data-bs-title="Editar Estado de Activo fijo" data-bs-toggle="modal" data-bs-target="#configModal"
                            hx-include="#listEstados" hx-post="{% url 'update-estados-htmx' %}" hx-target="#configModalContent" hx-swap="innerHTML" hx-trigger="click"
                            data-bs-toggle="modal" data-bs-target="#configModal"
                            class="btn btn-outline-primary-sdcn rounded-0 w-100">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button type="submit" id="delete-estados" data-bs-toggle-tooltip="tooltip"
                            data-bs-title="Eliminar Estado" class="btn btn-outline-danger-sdcn rounded-0 flex-grow-1 w-100">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </form>

        <!-- Formulario de Estados Historial -->
        <form class="col-sm-12 col-md-6 col-lg-6 col-xl-4 col-xxl-4 mb-3" method="post" id="estadosHistorialForm">
            {% csrf_token %}
            <input type="hidden" name="type" value="estados2">
            <input type="hidden" name="action" value="delete">
            <div class="card bg-transparent transition-200 h-100">
                <div class="card-header bg-secondary bg-opacity-10">
                    <h5 class="form-label fw-semibold text-uppercase text-muted mb-0">Acciones</h5>
                </div>
                <div class="card-body d-flex flex-column flex-md-row p-2 p-md-3">
                    <select id="listAcciones"
                        class="form-select bg-transparent border border-2 border-secondary-subtle mb-2 mb-md-0 me-md-2 flex-grow-1"
                        size="5" name="valor" required>
                        {% for value, label in ACCIONES_HISTORIAL.choices %}
                        <option value="{{ value }}">{{ label }}</option>
                        {% endfor %}
                    </select>
                    <div class="d-flex flex-row flex-md-column justify-content-center gap-2" style="min-width: 40px;">
                        <button type="button" id="create-acciones" data-bs-toggle-tooltip="tooltip"
                            data-bs-title="Agregar Estado de Activo fijo" data-bs-toggle="modal" data-bs-target="#configModal"
                            hx-get="{% url 'create-acciones-htmx' %}" hx-target="#configModalContent" hx-swap="innerHTML" hx-trigger="click"
                            class="btn btn-outline-success-sdcn rounded-0 w-100">
                            <i class="bi bi-plus-circle"></i>
                        </button>
                        <button type="button" id="update-acciones" data-bs-toggle-tooltip="tooltip"
                            data-bs-title="Editar Estado de Activo fijo" data-bs-toggle="modal" data-bs-target="#configModal"
                            hx-include="#listAcciones" hx-post="{% url 'update-acciones-htmx' %}" hx-target="#configModalContent" hx-swap="innerHTML" hx-trigger="click"
                            data-bs-toggle="modal" data-bs-target="#configModal"
                            class="btn btn-outline-primary-sdcn rounded-0 w-100">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button type="submit" id="delete-acciones" data-bs-toggle-tooltip="tooltip"
                            data-bs-title="Eliminar Acción" class="btn btn-outline-danger-sdcn rounded-0 flex-grow-1 w-100">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </form>

        <!-- Formulario de Dominio -->
        <form class="col-sm-12 col-md-6 col-lg-6 col-xl-4 col-xxl-4 mb-3" method="post" id="dominioForm">
            {% csrf_token %}
            <input type="hidden" name="type" value="dominio">
            <input type="hidden" name="action" value="update_dominio">
            <div class="card bg-transparent transition-200 h-100">
                <div class="card-header bg-secondary bg-opacity-10">
                    <h5 class="form-label fw-semibold text-uppercase text-muted mb-0">Dominio</h5>
                </div>
                <div class="card-body d-flex flex-column align-items-center">
                    <input class="form-control mb-3 w-100" type="text" name="dominio" required {% if dominio %}value="{{dominio}}" {% endif %}>
                    {% if dominio %}
                    <button class="btn btn-outline-black" type="submit">Actualizar</button>
                    {% else %}
                    <button class="btn btn-outline-black" type="submit">Enviar</button>
                    {% endif %}
                </div>
            </div>
        </form>

        <!-- Formulario de Entidad -->
        <form class="col-sm-12 col-md-6 col-lg-6 col-xl-4 col-xxl-4 mb-3" method="post" id="entidadForm">
            {% csrf_token %}
            <input type="hidden" name="type" value="entidad">
            <input type="hidden" name="action" value="update_entidad">
            <div class="card bg-transparent transition-200 h-100">
                <div class="card-header bg-secondary bg-opacity-10">
                    <h5 class="form-label fw-semibold text-uppercase text-muted mb-0">Entidad</h5>
                </div>
                <div class="card-body d-flex flex-column align-items-center">
                    <input class="form-control mb-3 w-100" type="text" name="entidad" required {% if entidad %}value="{{entidad}}" {% endif %}>
                    {% if entidad %}
                    <button class="btn btn-outline-black" type="submit">Actualizar</button>
                    {% else %}
                    <button class="btn btn-outline-black" type="submit">Enviar</button>
                    {% endif %}
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Modal para Crear/Editar -->

<div class="modal fade" id="configModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="configLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content overflow-hidden bg-invert shadow">
            <div class="border-bottom border-2 border-secondary-subtle w-100 d-flex" style="z-index: 1600;">
                <button class="btn-close p-2 ms-auto me-2 my-1" type="button" data-bs-toggle-tooltip="tooltip"
                    data-bs-title="Cerrar" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="position-relative px-5 py-4 z-index-overall d-flex flex-column" id="configModalContent">
                
            </div>
        </div>
    </div>
</div>
{% if messages %}
    {% for message in messages %}
        {% if ".." in message.message %}
        <script>
            var banner = document.createElement('div');
            banner.id = 'fullPageBanner';
            banner.className = 'position-fixed top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center bg-dark text-white';
            banner.style.zIndex = '1050';
            banner.innerHTML = '<div class="text-center"><h1 class="display-4">¡Operación realizada!</h1><h1 class="display-4" id="label-act">En 3 segundos la página se actualizará.</h1></div>';
            
            document.body.appendChild(banner);
            
            var tiempoRestante = 3;
            var labelAct = document.getElementById('label-act');
            var intervalo = setInterval(function() {
                tiempoRestante--;
                labelAct.textContent = 'En ' + tiempoRestante + ' segundos la página se actualizará.';
            
                if (tiempoRestante <= 0) {
                    clearInterval(intervalo);
                    document.body.removeChild(banner);
                    location.reload();
                }
            }, 1000);
        </script>
        {% endif %}
    {% endfor %}
{% endif %}
{% endblock content_dashboard %}